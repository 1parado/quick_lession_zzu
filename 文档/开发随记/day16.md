支付完成后的跳转问题（认证问题）我可以拿到token，但问题是拦截器拦截请求检查请求头中是否有token,我需要找到在哪里设置请求头的，可以debug找一下

​	准备专门做一个成功/失败页面，只有安全退出一个选择（暂时）

​	支付成功后跳转到成功页面，然后拿到localSession中的token，role，studentId，account，

​	现在的系统的studentPayment是放行的，但是希望是登录之后当前浏览器窗口内放行的。

​		目前看来不论是 当前窗口登录过的直接跳转，还是新窗口的直接跳转，都无任何区别

​		可以在正常跳转是加一个参数值是token

​		此时虽然给路由还是对外暴露，但是需要传入token参数才能访问，直接访问时无法获得token，通过登录流程时自动加入token，只需要在支付完成后的跳转时，加入token参数即可。



​	就是调用第三方的支付后，成功后需要获得登录状态，是第三方发起一个请求，但是系统拦截器会先拦截请求，判断请求头的token、，我又不可能在第三方发送请求时候加入请求头，所以一定会出现请求被拦截的情况



​	现在的流程是：点击缴费按钮	==》	调用支付宝支付接口	==》	支付成功后去发送/pay/success请求	==》	在success请求中跳转到前端页面

​	在此过程中，需要在success控制器中保存数据库，需要恢复登陆状态后跳转到前端

​	但是发向后端的所有请求会被拦截器拦截检查请求头中是否含有token，否则拦截请求

​	是以，这套流程完全不可行，因为我无法使支付宝接口发送的success请求额外添加一个请求头



​	改变流程：点击缴费按钮	==》	调用支付宝支付接口	==》	支付成功后直接跳转到前端页面

​	现在需要动态的拿token



​	在前端判断是否成功去额外发送请求保存数据库



​	现在支付成功后，直接给我跳转到登录页面

​	

支付完成后的数据保存问题（没有合适的参数）





破釜沉舟，重新来过

先修BUG

BUG:缴费记录显示所有的（应该只显示自己的）		1

BUG：教师6666003以及之后的登录状态异常			1





支付功能

点击缴费	===》	生成订单（注意订单状态）	===》	支付宝界面	===》	成功页面（可以显示订单信息）



引入依赖

​	目前，已经可以正确接入支付宝接口，成功后跳转回页面

​	问题：跳转到支付包接口要把原页面关掉	1

​		没有提示信息（没去异步通知）	1

​		没有保存到数据库			1

​		一个学生对一个缴费项目只允许缴费一次	1







