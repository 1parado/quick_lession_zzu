<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ly.mapper.CoursesMapper">
  <resultMap id="BaseResultMap" type="com.ly.pojo.Courses">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="course_code" jdbcType="VARCHAR" property="courseCode" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="credit" jdbcType="DOUBLE" property="credit" />
    <result column="course_type" jdbcType="OTHER" property="courseType" />
    <result column="college" jdbcType="VARCHAR" property="college" />
    <result column="capacity" jdbcType="INTEGER" property="capacity" />
    <result column="remain" jdbcType="INTEGER" property="remain" />
    <result column="is_seckill" jdbcType="INTEGER" property="isSeckill" />
    <result column="semester" jdbcType="VARCHAR" property="semester" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="teacher_id" jdbcType="INTEGER" property="teacherId" />
    <result column="class_time" jdbcType="VARCHAR" property="classTime" />
    <result column="class_location" jdbcType="VARCHAR" property="classLocation" />
    <result column="week_range" jdbcType="VARCHAR" property="weekRange" />
    <result column="pre_course" jdbcType="INTEGER" property="preCourse" />
  </resultMap>

  <resultMap id="CourseResultMap" type="com.ly.po.CoursesPO">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="course_code" jdbcType="VARCHAR" property="courseCode" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="credit" jdbcType="DOUBLE" property="credit" />
    <result column="course_type" jdbcType="OTHER" property="courseType" />
    <result column="college" jdbcType="VARCHAR" property="college" />
    <result column="capacity" jdbcType="INTEGER" property="capacity" />
    <result column="remain" jdbcType="INTEGER" property="remain" />
    <result column="is_seckill" jdbcType="INTEGER" property="isSeckill" />
    <result column="semester" jdbcType="VARCHAR" property="semester" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="teacher_name" jdbcType="VARCHAR" property="teacherName" />
    <result column="class_time" jdbcType="VARCHAR" property="classTime" />
    <result column="class_location" jdbcType="VARCHAR" property="classLocation" />
    <result column="week_range" jdbcType="VARCHAR" property="weekRange" />
    <result column="pre_course_code" jdbcType="VARCHAR" property="preCourseCode" />
    <result column="tno" jdbcType="BIGINT" property="tno" />
  </resultMap>

  <sql id="Base_Column_List">
    id, course_code, `name`, credit, course_type, college, capacity, remain, is_seckill, 
    semester, description, teacher_id, class_time, class_location, week_range, pre_course
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from courses
    where id = #{id,jdbcType=INTEGER}
  </select>

  <select id="selectCourseCodeByIdPO" parameterType="java.lang.Integer" resultType="java.lang.String">
    select
    course_code
    from courses
    where id = #{id,jdbcType=INTEGER}
  </select>

  <select id="selectIdByCourseCode" resultType="java.lang.Integer">
    select
      id
    from courses
    where course_code = #{preCourse}
  </select>

  <select id="selectByCourseCodePO" parameterType="java.lang.String" resultMap="CourseResultMap">
    select
      c.id, c.course_code, c.name, c.credit, c.course_type, c.college, c.capacity, c.remain, c.is_seckill,
      c.semester, c.description, t.name as teacher_name, c.class_time, c.class_location, c.week_range, c2.course_code as pre_course_code
    from courses c left join teachers t ON t.id = c.teacher_id
                   left join courses c2 ON c.pre_course = c2.id
    where c.course_code = #{courseCode}
  </select>

  <select id="selectCourse" resultMap="CourseResultMap">
    select
      c.id, c.course_code, c.name, c.credit, c.course_type, c.college, c.capacity, c.remain, c.is_seckill,
      c.semester, c.description, t.name as teacher_name, c.class_time, c.class_location, c.week_range, c2.course_code as pre_course_code, t.tno
    from courses c left join teachers t ON t.id = c.teacher_id
                    left join courses c2 ON c.pre_course = c2.id
  </select>

  <select id="selectCourseByIsSeckill" resultMap="CourseResultMap">
    select
      c.id, c.course_code, c.name, c.credit, c.course_type, c.college, c.capacity, c.remain, c.is_seckill,
      c.semester, c.description, t.name as teacher_name, c.class_time, c.class_location, c.week_range, c2.course_code as pre_course_code, t.tno
    from courses c left join teachers t ON t.id = c.teacher_id
                   left join courses c2 ON c.pre_course = c2.id
    where c.is_seckill = 1
  </select>

  <select id="selectCourseByNOIsSeckill" resultMap="CourseResultMap">
    select
      c.id, c.course_code, c.name, c.credit, c.course_type, c.college, c.capacity, c.remain, c.is_seckill,
      c.semester, c.description, t.name as teacher_name, c.class_time, c.class_location, c.week_range, c2.course_code as pre_course_code, t.tno
    from courses c left join teachers t ON t.id = c.teacher_id
                   left join courses c2 ON c.pre_course = c2.id
    where c.is_seckill = 0
  </select>

  <select id="selectCourseBySearch" resultMap="CourseResultMap">
    select
      c.id, c.course_code, c.name, c.credit, c.course_type, c.college, c.capacity, c.remain, c.is_seckill,
      c.semester, c.description, t.name as teacher_name, c.class_time, c.class_location, c.week_range, c2.course_code as pre_course_code, t.tno
    from courses c left join teachers t ON t.id = c.teacher_id
                   left join courses c2 ON c.pre_course = c2.id
    where c.is_seckill = 0 AND c.name LIKE CONCAT('%', #{searchText}, '%')
  </select>

  <select id="selectAllCourseBySearch" resultMap="CourseResultMap">
    select
      c.id, c.course_code, c.name, c.credit, c.course_type, c.college, c.capacity, c.remain, c.is_seckill,
      c.semester, c.description, t.name as teacher_name, c.class_time, c.class_location, c.week_range, c2.course_code as pre_course_code, t.tno
    from courses c left join teachers t ON t.id = c.teacher_id
                   left join courses c2 ON c.pre_course = c2.id
    where c.name LIKE CONCAT('%', #{searchText}, '%')
  </select>

  <select id="selectCourseByCourseId" resultMap="CourseResultMap">
    select
    c.id, c.course_code, c.name, c.credit, c.course_type, c.college, c.capacity, c.remain, c.is_seckill,
    c.semester, c.description, t.name as teacher_name, c.class_time, c.class_location, c.week_range, c2.course_code as pre_course_code, t.tno
    from courses c left join teachers t ON t.id = c.teacher_id
    left join courses c2 ON c.pre_course = c2.id
    WHERE c.id IN
    <foreach collection="courseIdList" item="courseId" open="(" separator="," close=")">
      #{courseId}
    </foreach>
  </select>

  <select id="selectCourseByCourseIdBySemester" resultMap="CourseResultMap">
    select
    c.id, c.course_code, c.name, c.credit, c.course_type, c.college, c.capacity, c.remain, c.is_seckill,
    c.semester, c.description, t.name as teacher_name, c.class_time, c.class_location, c.week_range, c2.course_code as pre_course_code, t.tno
    from courses c left join teachers t ON t.id = c.teacher_id
    left join courses c2 ON c.pre_course = c2.id
    WHERE c.id IN
    <foreach collection="courseIdList" item="courseId" open="(" separator="," close=")">
      #{courseId}
    </foreach>
    AND c.semester = #{currentSemester}
  </select>


    <select id="selectPreCourseIdById" resultType="java.lang.Integer">
        SELECT pre_course
        FROM courses
        WHERE
            id = #{courseId}
    </select>
    <select id="selectIdByPreCourseId" resultType="java.lang.Integer">
      SELECT id
      FROM courses
      WHERE pre_course = #{preCourseId}
    </select>
  <select id="selectCourseByTeacherId" resultMap="CourseResultMap">
    select
      c.id, c.course_code, c.name, c.credit, c.course_type, c.college, c.capacity, c.remain, c.is_seckill,
      c.semester, c.description, t.name as teacher_name, c.class_time, c.class_location, c.week_range, c2.course_code as pre_course_code, t.tno
    from courses c left join teachers t ON t.id = c.teacher_id
                   left join courses c2 ON c.pre_course = c2.id
    WHERE c.teacher_id = #{teacherId}
  </select>

  <select id="selectCourseByTeacherIdByExam" resultMap="CourseResultMap">
    select
      c.id, c.course_code, c.name, c.credit, c.course_type, c.college, c.capacity, c.remain, c.is_seckill,
      c.semester, c.description, t.name as teacher_name, c.class_time, c.class_location, c.week_range, c2.course_code as pre_course_code, t.tno
    from courses c left join teachers t ON t.id = c.teacher_id
                   left join courses c2 ON c.pre_course = c2.id
                    left join exam e ON c.course_code = e.course_code
    WHERE c.teacher_id = #{teacherId} AND e.state = 3
  </select>

  <select id="selectCourseByTeacherIdBySemester" resultMap="CourseResultMap">
    select
      c.id, c.course_code, c.name, c.credit, c.course_type, c.college, c.capacity, c.remain, c.is_seckill,
      c.semester, c.description, t.name as teacher_name, c.class_time, c.class_location, c.week_range, c2.course_code as pre_course_code, t.tno
    from courses c left join teachers t ON t.id = c.teacher_id
                   left join courses c2 ON c.pre_course = c2.id
    WHERE c.teacher_id = #{teacherId} AND c.semester = #{currentSemester}
  </select>
  <select id="selectIdByTeacherId" resultType="java.lang.Integer">
    SELECT
      id
    FROM courses
    WHERE teacher_id = #{id}
  </select>
    <select id="selectAll" resultMap="BaseResultMap">
      SELECT
          *
      FROM
          courses
    </select>
    <select id="selectTeacherIdByCourseCode" resultType="java.lang.Integer">
      SELECT
          teacher_id
      FROM
        courses
      WHERE
          course_code = #{courseCode}
    </select>
  <select id="selectCourseCodeByTeacherId" resultType="java.lang.String">
    SELECT
        course_code
    FROM
      courses
    WHERE
        teacher_id = #{teacherId}
    LIMIT
        #{count}
  </select>
    <select id="selectByCourseCodeAndTeacherId" resultMap="BaseResultMap">
        SELECT *
        FROM
            courses
        WHERE
            teacher_id = #{teacherId}
        AND
          course_code = #{code}
    </select>
    <select id="selectIdByCourseName" resultType="java.lang.Integer">
      SELECT id
      FROM courses
      WHERE name = #{courseName}
    </select>
  <select id="selectCourseNameById" resultType="java.lang.String">
    SELECT
        name
    FROM
        courses
    WHERE
        id = #{id}
  </select>


  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from courses
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" keyColumn="id" keyProperty="id" parameterType="com.ly.pojo.Courses" useGeneratedKeys="true">
    insert into courses (course_code, `name`, credit, 
      course_type, college, capacity, 
      remain, is_seckill, semester, 
      description, teacher_id, class_time, 
      class_location, week_range, pre_course
      )
    values (#{courseCode,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, #{credit,jdbcType=DOUBLE}, 
      #{courseType,jdbcType=OTHER}, #{college,jdbcType=VARCHAR}, #{capacity,jdbcType=INTEGER}, 
      #{remain,jdbcType=INTEGER}, #{isSeckill,jdbcType=INTEGER}, #{semester,jdbcType=VARCHAR}, 
      #{description,jdbcType=VARCHAR}, #{teacherId,jdbcType=INTEGER}, #{classTime,jdbcType=VARCHAR}, 
      #{classLocation,jdbcType=VARCHAR}, #{weekRange,jdbcType=VARCHAR}, #{preCourse,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" keyColumn="id" keyProperty="id" parameterType="com.ly.pojo.Courses" useGeneratedKeys="true">
    insert into courses
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="courseCode != null">
        course_code,
      </if>
      <if test="name != null">
        `name`,
      </if>
      <if test="credit != null">
        credit,
      </if>
      <if test="courseType != null">
        course_type,
      </if>
      <if test="college != null">
        college,
      </if>
      <if test="capacity != null">
        capacity,
      </if>
      <if test="remain != null">
        remain,
      </if>
      <if test="isSeckill != null">
        is_seckill,
      </if>
      <if test="semester != null">
        semester,
      </if>
      <if test="description != null">
        description,
      </if>
      <if test="teacherId != null">
        teacher_id,
      </if>
      <if test="classTime != null">
        class_time,
      </if>
      <if test="classLocation != null">
        class_location,
      </if>
      <if test="weekRange != null">
        week_range,
      </if>
      <if test="preCourse != null">
        pre_course,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="courseCode != null">
        #{courseCode,jdbcType=VARCHAR},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="credit != null">
        #{credit,jdbcType=DOUBLE},
      </if>
      <if test="courseType != null">
        #{courseType,jdbcType=OTHER},
      </if>
      <if test="college != null">
        #{college,jdbcType=VARCHAR},
      </if>
      <if test="capacity != null">
        #{capacity,jdbcType=INTEGER},
      </if>
      <if test="remain != null">
        #{remain,jdbcType=INTEGER},
      </if>
      <if test="isSeckill != null">
        #{isSeckill,jdbcType=INTEGER},
      </if>
      <if test="semester != null">
        #{semester,jdbcType=VARCHAR},
      </if>
      <if test="description != null">
        #{description,jdbcType=VARCHAR},
      </if>
      <if test="teacherId != null">
        #{teacherId,jdbcType=INTEGER},
      </if>
      <if test="classTime != null">
        #{classTime,jdbcType=VARCHAR},
      </if>
      <if test="classLocation != null">
        #{classLocation,jdbcType=VARCHAR},
      </if>
      <if test="weekRange != null">
        #{weekRange,jdbcType=VARCHAR},
      </if>
      <if test="preCourse != null">
        #{preCourse,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.ly.pojo.Courses">
    update courses
    <set>
      <if test="courseCode != null">
        course_code = #{courseCode,jdbcType=VARCHAR},
      </if>
      <if test="name != null">
        `name` = #{name,jdbcType=VARCHAR},
      </if>
      <if test="credit != null">
        credit = #{credit,jdbcType=DOUBLE},
      </if>
      <if test="courseType != null">
        course_type = #{courseType,jdbcType=OTHER},
      </if>
      <if test="college != null">
        college = #{college,jdbcType=VARCHAR},
      </if>
      <if test="capacity != null">
        capacity = #{capacity,jdbcType=INTEGER},
      </if>
      <if test="remain != null">
        remain = #{remain,jdbcType=INTEGER},
      </if>
      <if test="isSeckill != null">
        is_seckill = #{isSeckill,jdbcType=INTEGER},
      </if>
      <if test="semester != null">
        semester = #{semester,jdbcType=VARCHAR},
      </if>
      <if test="description != null">
        description = #{description,jdbcType=VARCHAR},
      </if>
      <if test="teacherId != null">
        teacher_id = #{teacherId,jdbcType=INTEGER},
      </if>
      <if test="classTime != null">
        class_time = #{classTime,jdbcType=VARCHAR},
      </if>
      <if test="classLocation != null">
        class_location = #{classLocation,jdbcType=VARCHAR},
      </if>
      <if test="weekRange != null">
        week_range = #{weekRange,jdbcType=VARCHAR},
      </if>
      <if test="preCourse != null">
        pre_course = #{preCourse,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.ly.pojo.Courses">
    update courses
    set course_code = #{courseCode,jdbcType=VARCHAR},
      `name` = #{name,jdbcType=VARCHAR},
      credit = #{credit,jdbcType=DOUBLE},
      course_type = #{courseType,jdbcType=OTHER},
      college = #{college,jdbcType=VARCHAR},
      capacity = #{capacity,jdbcType=INTEGER},
      remain = #{remain,jdbcType=INTEGER},
      is_seckill = #{isSeckill,jdbcType=INTEGER},
      semester = #{semester,jdbcType=VARCHAR},
      description = #{description,jdbcType=VARCHAR},
      teacher_id = #{teacherId,jdbcType=INTEGER},
      class_time = #{classTime,jdbcType=VARCHAR},
      class_location = #{classLocation,jdbcType=VARCHAR},
      week_range = #{weekRange,jdbcType=VARCHAR},
      pre_course = #{preCourse,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>

  <update id="updatePreCourseByoldCode" >
    update courses
    set
        pre_course = #{newCode}
    where course_code = #{oldCode}
  </update>
  <update id="updateByPreCourseId">
    update courses
    set
        pre_course = null
    where pre_course = #{id}
  </update>
  <update id="updateByTeacherId">
    update courses
    set
        teacher_id = null
    where teacher_id = #{id}

  </update>
    <update id="updateRemainByCourseId">
      update courses
      set remain = remain - 1
      where id = #{courseId}
    </update>
  <update id="updateRemainByCourseIdAdd">
    update courses
    set remain = remain + 1
    where id = #{courseId}
  </update>
</mapper>